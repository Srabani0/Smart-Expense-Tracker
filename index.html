<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Expense Tracker</title>
  <link rel="icon" href="./Assets/logo.png" type="png">
  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(120deg, #f3ecff, #ffffff);
      min-height: 100vh;
    }

    .navbar {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    .navbar-brand span {
      font-weight: 700;
      color: #7b2ff7;
    }

    .card {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      transition: 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    table th {
      background-color: #7b2ff7;
      color: white;
      border: none;
    }

    .btn-purple {
      background: linear-gradient(45deg, #7b2ff7, #9f44ff);
      color: white;
      border: none;
      transition: 0.3s;
    }

    .btn-purple:hover {
      background: linear-gradient(45deg, #6825d1, #872be5);
      color: #fff;
    }

    .filter-card {
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(123, 47, 247, 0.2);
      border-radius: 1rem;
      padding: 1rem 1.5rem;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.04);
    }

    .total-card {
      background: linear-gradient(90deg, #7b2ff7, #9f44ff);
      color: white;
      font-weight: 600;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-light">
    <div class="container">
      <a href="#" class="navbar-brand d-flex align-items-center">
        <img src="./Assets/logo.png" alt="logo" height="30">
        <span class="ms-2 fs-4">Smart Expense Tracker</span>
      </a>
    </div>
  </nav>

  <div class="container mt-5">
    <!-- Filter Section -->
    <div class="filter-card mb-4">
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Category</label>
          <select id="filterCategory" class="form-select">
            <option value="">All Categories</option>
            <option>Food</option>
            <option>Travel</option>
            <option>Shopping</option>
            <option>Bills</option>
            <option>Entertainment</option>
            <option>Other</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Date</label>
          <input type="date" id="filterDate" class="form-control" />
        </div>
        <div class="col-md-4 text-end">
          <button class="btn btn-purple" onclick="applyFilters()"><i class="bi bi-funnel"></i> Apply Filters</button>
          <button class="btn btn-outline-secondary ms-2" onclick="resetFilters()"><i class="bi bi-arrow-clockwise"></i> Reset</button>
        </div>
      </div>
    </div>

    <!-- Add Button -->
    <div class="d-flex justify-content-end mb-3">
      <button class="btn btn-purple" onclick="showExpenseModal()">
        <i class="bi bi-plus-circle"></i> Add Expense
      </button>
    </div>

    <!-- Expense Table -->
    <div class="card fade-in">
      <div class="card-body">
        <table class="table align-middle text-center">
          <thead>
            <tr>
              <th>#</th>
              <th>Description</th>
              <th>Category</th>
              <th>Date</th>
              <th>Amount (₹)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="expenseTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Total -->
    <div class="mt-4 text-center total-card fade-in">
      Total Expense: ₹<span id="totalSpent">0</span>
    </div>
  </div>

  <!-- Expense Modal -->
  <div class="modal fade" id="addExpenseModal" tabindex="-1">
    <form id="addExpenseForm">
      <div class="modal-dialog">
        <div class="modal-content border-0 shadow">
          <div class="modal-header bg-light">
            <h5 class="modal-title text-purple">Add / Edit Expense</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editIndex" />
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea id="addExpenseDescription" class="form-control" rows="2" placeholder="Expense details"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Category</label>
              <select id="addCategory" class="form-select">
                <option>Food</option>
                <option>Travel</option>
                <option>Shopping</option>
                <option>Bills</option>
                <option>Entertainment</option>
                <option>Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Date</label>
              <input type="date" id="addExpenditureDate" class="form-control" />
            </div>
            <div class="mb-3">
              <label class="form-label">Amount</label>
              <input type="number" id="addSpentAmount" class="form-control" placeholder="Amount in ₹" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-purple" onclick="SaveExpense()">Save</button>
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      createTableFromJSON();
      getTotalExpenditure();
    });

    function showExpenseModal(index = null) {
      document.getElementById("editIndex").value = index ?? "";
      if (index !== null) {
        let data = JSON.parse(localStorage.getItem("expenseStorage"))[index];
        document.getElementById("addExpenseDescription").value = data.addExpenseDescription;
        document.getElementById("addCategory").value = data.addCategory;
        document.getElementById("addExpenditureDate").value = data.addExpenditureDate;
        document.getElementById("addSpentAmount").value = data.addSpentAmount;
      } else {
        document.getElementById("addExpenseForm").reset();
      }
      new bootstrap.Modal(document.getElementById("addExpenseModal")).show();
    }

    function SaveExpense() {
      let index = document.getElementById("editIndex").value;
      let expenseObject = {
        addExpenseDescription: document.getElementById("addExpenseDescription").value,
        addCategory: document.getElementById("addCategory").value,
        addExpenditureDate: document.getElementById("addExpenditureDate").value,
        addSpentAmount: document.getElementById("addSpentAmount").value,
      };

      let expenses = JSON.parse(localStorage.getItem("expenseStorage")) || [];
      if (index) expenses[index] = expenseObject;
      else expenses.push(expenseObject);

      localStorage.setItem("expenseStorage", JSON.stringify(expenses));
      bootstrap.Modal.getInstance(document.getElementById("addExpenseModal")).hide();
      createTableFromJSON();
      getTotalExpenditure();
    }

    function createTableFromJSON(filteredData = null) {
      let data = filteredData || JSON.parse(localStorage.getItem("expenseStorage")) || [];
      let html = data.length
        ? data
            .map((d, i) => {
              let date = new Date(d.addExpenditureDate).toLocaleDateString("en-IN");
              return `
                <tr>
                  <td>${i + 1}</td>
                  <td>${d.addExpenseDescription}</td>
                  <td><span class="badge bg-${getCategoryColor(d.addCategory)}">${d.addCategory}</span></td>
                  <td>${date}</td>
                  <td>₹${d.addSpentAmount}</td>
                  <td>
                    <i class="bi bi-pencil-square text-primary me-2" style="cursor:pointer" onclick="showExpenseModal(${i})"></i>
                    <i class="bi bi-trash3 text-danger" style="cursor:pointer" onclick="deleteExpense(${i})"></i>
                  </td>
                </tr>`;
            })
            .join("")
        : `<tr><td colspan="6" class="text-muted">No expenses found</td></tr>`;

      document.getElementById("expenseTableBody").innerHTML = html;
    }

    function getCategoryColor(category) {
      const colors = { Food: "success", Travel: "info", Shopping: "warning", Bills: "secondary", Entertainment: "primary", Other: "dark" };
      return colors[category] || "dark";
    }

    function deleteExpense(index) {
      if (confirm("Delete this expense?")) {
        let data = JSON.parse(localStorage.getItem("expenseStorage")) || [];
        data.splice(index, 1);
        localStorage.setItem("expenseStorage", JSON.stringify(data));
        createTableFromJSON();
        getTotalExpenditure();
      }
    }

    function getTotalExpenditure(filteredData = null) {
      let data = filteredData || JSON.parse(localStorage.getItem("expenseStorage")) || [];
      let total = data.reduce((sum, d) => sum + Number(d.addSpentAmount || 0), 0);
      document.getElementById("totalSpent").innerText = total;
    }

    function applyFilters() {
      let category = document.getElementById("filterCategory").value;
      let date = document.getElementById("filterDate").value;
      let data = JSON.parse(localStorage.getItem("expenseStorage")) || [];

      // Filter by category/date
      let filtered = data.filter((item) => {
        return (
          (category === "" || item.addCategory === category) &&
          (date === "" || item.addExpenditureDate.startsWith(date))
        );
      });

      // If date is chosen, show total for that month
      if (date) {
        let selectedMonth = new Date(date).getMonth();
        filtered = data.filter(
          (item) => new Date(item.addExpenditureDate).getMonth() === selectedMonth
        );
      }

      createTableFromJSON(filtered);
      getTotalExpenditure(filtered);
    }

    function resetFilters() {
      document.getElementById("filterCategory").value = "";
      document.getElementById("filterDate").value = "";
      createTableFromJSON();
      getTotalExpenditure();
    }
  </script>
</body>
</html>
